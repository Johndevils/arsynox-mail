<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arsynox Mail - Temporary Email Service</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        .email-item {
            transition: all 0.2s ease;
        }
        .email-item:hover {
            transform: translateX(4px);
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-envelope text-3xl"></i>
                    <h1 class="text-2xl font-bold">Arsynox Mail</h1>
                </div>
                <div class="text-sm">
                    <i class="fas fa-shield-alt mr-2"></i>
                    Secure Temporary Email
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Email Address Section -->
        <section class="mb-8">
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex-1 w-full">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-at mr-2"></i>Your Temporary Email Address
                        </label>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="emailAddress" 
                                readonly 
                                class="flex-1 px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                                placeholder="Generating email..."
                            >
                            <button 
                                onclick="copyEmail()" 
                                class="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                                title="Copy email address"
                            >
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button 
                            onclick="generateNewEmail()" 
                            class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all transform hover:scale-105 shadow-md"
                        >
                            <i class="fas fa-sync-alt mr-2"></i>
                            New Email
                        </button>
                        <button 
                            onclick="refreshInbox()" 
                            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loading State -->
        <div id="loadingState" class="hidden">
            <div class="flex flex-col items-center justify-center py-12">
                <div class="loading-spinner mb-4"></div>
                <p class="text-gray-600">Loading...</p>
            </div>
        </div>

        <!-- Stats Section -->
        <section class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Total Messages</p>
                            <p class="text-2xl font-bold text-gray-800" id="totalMessages">0</p>
                        </div>
                        <i class="fas fa-inbox text-3xl text-purple-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Unread</p>
                            <p class="text-2xl font-bold text-gray-800" id="unreadMessages">0</p>
                        </div>
                        <i class="fas fa-envelope text-3xl text-blue-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Auto Refresh</p>
                            <p class="text-sm font-semibold text-green-600">Every 30s</p>
                        </div>
                        <i class="fas fa-clock text-3xl text-green-500"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Inbox Section -->
        <section>
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4">
                    <h2 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-inbox mr-3"></i>
                        Inbox
                    </h2>
                </div>
                <div id="inboxContainer" class="max-h-96 overflow-y-auto">
                    <div id="emptyState" class="p-12 text-center">
                        <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">No messages yet</p>
                        <p class="text-gray-400 text-sm mt-2">Your inbox is empty. Messages will appear here automatically.</p>
                    </div>
                    <div id="emailList" class="hidden">
                        <!-- Emails will be inserted here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Email Modal -->
    <div id="emailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Email Details</h3>
                <button onclick="closeEmailModal()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[60vh]">
                <div id="emailContent">
                    <!-- Email content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg hidden transform transition-all duration-300 z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span id="toastMessage">Success!</span>
        </div>
    </div>

    <script>
        let currentEmail = '';
        let currentToken = '';
        let refreshInterval;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            generateNewEmail();
        });

        // Generate new email
        async function generateNewEmail() {
            showLoading(true);
            try {
                // Get domains
                const domainsResponse = await fetch('https://api.mail.tm/domains');
                const domainsData = await domainsResponse.json();
                
                if (!domainsData['hydra:member'] || domainsData['hydra:member'].length === 0) {
                    throw new Error('No domains available');
                }

                const domain = domainsData['hydra:member'][0].domain;
                const username = Math.random().toString(36).substring(2, 10);
                currentEmail = `${username}@${domain}`;

                // Create account
                const accountResponse = await fetch('https://api.mail.tm/accounts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        address: currentEmail,
                        password: 'tempPassword123'
                    })
                });

                if (!accountResponse.ok) {
                    throw new Error('Failed to create account');
                }

                // Get JWT token
                const authResponse = await fetch('https://api.mail.tm/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        address: currentEmail,
                        password: 'tempPassword123'
                    })
                });

                if (!authResponse.ok) {
                    throw new Error('Failed to authenticate');
                }

                const authData = await authResponse.json();
                currentToken = authData.token;

                // Update UI
                document.getElementById('emailAddress').value = currentEmail;
                
                // Start auto-refresh
                startAutoRefresh();
                
                // Load messages
                await loadMessages();
                
                showToast('New email generated successfully!');
            } catch (error) {
                console.error('Error generating email:', error);
                showToast('Failed to generate email. Please try again.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load messages
        async function loadMessages() {
            if (!currentToken) return;

            try {
                const response = await fetch('https://api.mail.tm/messages', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load messages');
                }

                const data = await response.json();
                const messages = data['hydra:member'] || [];
                
                displayMessages(messages);
                updateStats(messages);
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }

        // Display messages
        function displayMessages(messages) {
            const emailList = document.getElementById('emailList');
            const emptyState = document.getElementById('emptyState');

            if (messages.length === 0) {
                emailList.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            emailList.classList.remove('hidden');
            emptyState.classList.add('hidden');

            emailList.innerHTML = messages.map((message, index) => `
                <div class="email-item border-b hover:bg-gray-50 cursor-pointer p-4 fade-in" style="animation-delay: ${index * 0.05}s" onclick="viewEmail('${message.id}')">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-1">
                                <span class="font-semibold text-gray-800">${escapeHtml(message.from.name || message.from.address)}</span>
                                <span class="text-xs text-gray-500 ml-2"><${escapeHtml(message.from.address)}></span>
                            </div>
                            <h4 class="text-gray-900 font-medium mb-1">${escapeHtml(message.subject)}</h4>
                            <p class="text-gray-600 text-sm truncate">${escapeHtml(message.textPreview || message.intro)}</p>
                        </div>
                        <div class="text-right ml-4">
                            <p class="text-xs text-gray-500">${formatDate(message.createdAt)}</p>
                            ${!message.seen ? '<span class="inline-block mt-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">New</span>' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // View email
        async function viewEmail(messageId) {
            if (!currentToken) return;

            showLoading(true);
            try {
                const response = await fetch(`https://api.mail.tm/messages/${messageId}`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load email');
                }

                const message = await response.json();
                displayEmailContent(message);
                
                // Mark as read
                await fetch(`https://api.mail.tm/messages/${messageId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ seen: true })
                });

                // Refresh messages to update read status
                await loadMessages();
            } catch (error) {
                console.error('Error viewing email:', error);
                showToast('Failed to load email', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Display email content
        function displayEmailContent(message) {
            const content = document.getElementById('emailContent');
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="border-b pb-4">
                        <h2 class="text-xl font-semibold text-gray-900 mb-2">${escapeHtml(message.subject)}</h2>
                        <div class="flex items-center justify-between text-sm text-gray-600">
                            <div>
                                <p><strong>From:</strong> ${escapeHtml(message.from.name || message.from.address)} <${escapeHtml(message.from.address)}></p>
                                <p><strong>To:</strong> ${escapeHtml(message.to[0].address)}</p>
                            </div>
                            <p>${formatDate(message.createdAt)}</p>
                        </div>
                    </div>
                    <div class="prose max-w-none">
                        ${message.html ? message.html : `<pre class="whitespace-pre-wrap text-gray-800">${escapeHtml(message.text)}</pre>`}
                    </div>
                </div>
            `;
            
            document.getElementById('emailModal').classList.remove('hidden');
        }

        // Close email modal
        function closeEmailModal() {
            document.getElementById('emailModal').classList.add('hidden');
        }

        // Refresh inbox
        async function refreshInbox() {
            await loadMessages();
            showToast('Inbox refreshed!');
        }

        // Copy email address
        function copyEmail() {
            const emailInput = document.getElementById('emailAddress');
            emailInput.select();
            document.execCommand('copy');
            showToast('Email address copied to clipboard!');
        }

        // Start auto refresh
        function startAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            refreshInterval = setInterval(loadMessages, 30000); // Refresh every 30 seconds
        }

        // Update stats
        function updateStats(messages) {
            const totalMessages = messages.length;
            const unreadMessages = messages.filter(m => !m.seen).length;
            
            document.getElementById('totalMessages').textContent = totalMessages;
            document.getElementById('unreadMessages').textContent = unreadMessages;
        }

        // Show loading
        function showLoading(show) {
            const loadingState = document.getElementById('loadingState');
            if (show) {
                loadingState.classList.remove('hidden');
            } else {
                loadingState.classList.add('hidden');
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            
            if (type === 'error') {
                toast.className = 'fixed bottom-4 right-4 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 z-50';
            } else {
                toast.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 z-50';
            }
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Utility functions
        function escapeHtml(text) {
            const map = {
                '&': '&',
                '<': '<',
                '>': '>',
                '"': '"',
                "'": '''
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) {
                return 'Just now';
            } else if (diff < 3600000) {
                return Math.floor(diff / 60000) + ' minutes ago';
            } else if (diff < 86400000) {
                return Math.floor(diff / 3600000) + ' hours ago';
            } else {
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
            }
        }

        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEmailModal();
            }
        });

        // Close modal on background click
        document.getElementById('emailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEmailModal();
            }
        });
    </script>
</body>
</html>
